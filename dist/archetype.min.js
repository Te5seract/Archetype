(()=>{"use strict";window.Archetype=class{constructor(t){this.callback=t,this.useGlobal=[],this.callback&&this.callback()}_getMethodTypes(t){return{loud:[],decorators:[],quiet:[],sort:function(){return t.filter((t=>{t.match(/\$([a-zA-Z]|\d+)/)?this.loud.push(t):t.match(/__.*?/)?this.decorators.push(t):this.quiet.push(t)})),delete this.sort,this}}.sort()}_callMethods(t,e){const{loud:s,decorators:o}=e;s.forEach((e=>{const s={};this._pushDecorator(s,t,e,o),t[e](s)}))}_pushDecorator(t,e,s,o){s=s.replace(/\$/,""),o.forEach((s=>{const o=this._decoratorName(s);t[o]=e[s]}))}_decoratorName(t){const e=t.replace(/__/,"").split("_");return e.forEach(((t,s)=>{if(s>0){const o=t.split(""),r=o.splice(0,1);e[s]=r[0].toUpperCase()+o.join("")}})),e.join("")}_routeParams(t){const e={params:{}};t instanceof Array||(t=[t]);for(let s=0;s<t.length;s++)if(t[s]){const o=window.location.pathname,r=o.split("/"),n=t[s].match(/{.*?}/g),i=t[s].split("/");if(t[s].match(/{.*?}/g)){if(n.forEach((t=>{const s=i.indexOf(t),o=t.replace(/{|}/g,"");i[s]=r[s],e.params[o]=r[s]})),o===i.join("/"))return e.match=!0,e.routeProcessed=i.join("/"),e}else{new RegExp(`^${t[s]}$`);if(t[s]===o)return e.match=!0,e}}return e}_makeProps(t,e){this[t]=e}_setProps(t,...e){if(this[t]){let s=this[t];for(let t=0;t<e.length;t++)if(s[e[t]])s=s[e[t]];else{if(t+1===e.length-1){s[e[t]]=e[t+1];break}s=s[e[t]]={}}}}_getProps(t,...e){if(!e.length)return this[t];const s=this[t];let o=this[t];return e.forEach((t=>{o[t]?o=o[t]:console.error(`_getProps error: ${t.join(" > ")} in "${s.constructor.name}" was not found: ${s.constructor.name}`,s)})),o}_shareWithInstance(){this.useGlobal.forEach((t=>{if(t.shareWith){const e=Object.keys(t).filter((t=>!t.match(/shareWith/i)))[0];t.shareWith.forEach((s=>{s.prototype[e]=t[e]}))}}))}_use(t,e){Object.getOwnPropertyNames(t.prototype).join(",");const s=this._getMethod(t,"use_","uses_"),o=this.useGlobal,r={};if(e instanceof Function&&!(e={scope:e}).use&&o.length&&(e.use=o),e.use||(e.use=[]),!s)return;this.useGlobal.length&&this.useGlobal.forEach((t=>{e.use.push(t)})),e.use.forEach((t=>{for(let e in t)r[e]=t[e]}));const n=t.prototype[s](r);n&&n.forEach((e=>{if(e.prototype){Object.getOwnPropertyNames(e.prototype).forEach((s=>{t.prototype[s]=e.prototype[s]}))}else e.methods&&e.scope&&e.methods.forEach((s=>{t.prototype[s]=e.scope.prototype[s]}))}))}_getMethod(t,...e){const s=Object.getOwnPropertyNames(t.prototype).join(","),o=e.join("|"),r=new RegExp(o,"gi"),n=s.match(r);return!!n&&n[0]}_setAccessors(){this._setProps("instance_proto","get",((...t)=>this._getProps("instance_proto",...t)))}_instantiate(){this.instances&&this.instances.forEach((t=>{const e=new t,s=this._getMethodTypes(Object.getOwnPropertyNames(Object.getPrototypeOf(e)));this._setProps("instance_proto",e.constructor.name,e),this._callMethods(e,s)}))}load(t){return t.forEach((t=>{const e=Object.getOwnPropertyNames(t instanceof Function?t.prototype:t.scope.prototype),s=t instanceof Function?t:t.scope;if(-1!==e.indexOf("route_")){const e=this._routeParams(s.prototype.route_());if(e.match){this._makeProps("instance_proto",s.prototype),this._setProps("instance_proto","route",e),this._use(s,t),this._setAccessors(s);const o=new s,r=this._getMethodTypes(Object.getOwnPropertyNames(Object.getPrototypeOf(o)));this._instantiate(),this._callMethods(o,r)}}})),this}instantiate(t){this._makeProps("instances",t)}use(t){if(t.length)return this.useGlobal=t,this._shareWithInstance(),this}}})();