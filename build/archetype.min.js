(()=>{"use strict";class t{}class e extends t{constructor({pages:t,reservoir:e,config:s,componentService:i}){super(),this.pages=t,this.reservoir=e,this.config=s,this.currentRoute=window.location.pathname,this.componentService=i,this.#t(),this.page&&(this.#e(),this.#s())}#e(){this.page.prototype.route_=this.#i.bind(this)}#i(){return this.queries}#t(){this.pages(this.#o.bind(this))}#o(t,...e){if(this.match)return;this.components=e;this.config.read("pages",t);this.#n(t)}#n(t){const{route:e}=this.config.get();this.pageRoute=e,e.forEach((e=>{e.match(/{.*}/g)?this.#r(t):this.#c(t)}))}#c(t){-1!==this.pageRoute.indexOf(this.currentRoute)&&(this.page=t,this.match=!0)}#r(t){const e=this.currentRoute.split("/");this.pageRoute.forEach((s=>{const i=s.split("/"),o=[],n=new Map;i.length===e.length&&(i.forEach(((t,s)=>{if(t.match(/{.*}/))return o.push(e[s]),void n.set(t.replace(/{|}/g,""),e[s]);o.push(t)})),o.join("/")===this.currentRoute&&(this.page=t,this.queries=n,this.match=!0))}))}#s(){this.reservoir.set("page",this.page),this.components.forEach((t=>{this.config.read("component",t),this.reservoir.component})),new this.componentService({components:this.components,reservoir:this.reservoir,config:this.config})}}class s extends t{constructor({components:t,reservoir:e,config:s}){super(),this.components=t,this.reservoir=e,this.config=s,this.#s()}#s(){this.reservoir.set("components",new Map),this.components.forEach((t=>{this.config.read("component",t);const e=this.config.get().name;this.reservoir.get("components").set(e,t)}))}}class i extends t{constructor({constants:t,reservoir:e,config:s}){super(),this.constants=t,this.reservoir=e,this.config=s,this.reservoir.set("constants",new Map),this.#h()}#o(t){this.config.read("constant",t),this.#s(t)}#h(){this.constants(this.#o.bind(this))}#s(t){const{name:e}=this.config.get();this.reservoir.get("constants").set(e,t)}}class o extends t{constructor({globals:t,reservoir:e,config:s}){super(),this.globals=t,this.reservoir=e,this.config=s,this.reservoir.set("globals",new Map),this.#g()}#o(t){this.config.read("globals",t),this.#s(t)}#g(){this.globals(this.#o.bind(this))}#s(t){const{name:e}=this.config.get();this.reservoir.get("globals").set(e,t)}}class n{name(t){const e=t.prototype.config_,s=t.prototype.constructor.name;return e&&e()&&e().name?e().name:s}configInject(t){if(!t)return{...this.$inject};const e={...t,...this.$inject};return()=>e}}class r extends n{constructor(t){super(),this.page=t,this.name=this.page.prototype.constructor.name,this.config=this.page.prototype.config_?this.page.prototype.config_:this.page.config_,this.errors={noconfig:`Archetype Error: "${this.name}" does not have a config_() method.`,noroute:`Archetype Error: "${this.name}" does not have a route property in the config_() method`},this.$inject={name:this.name,type:"page"},this.#a()}#a(){if(!this.config)throw this.errors.noconfig;this.#p()}#p(){if(!this.config().route)throw this.errors.noroute;this.#f()}#f(){if(!this.config||!this.config())return this.page.prototype.config_=super.configInject.bind(this),void(this.config=this.page.prototype.config_);this.page.prototype.config_=super.configInject(this.config()).bind(this),this.config=this.page.prototype.config_}get(){return this.config()}}class c extends n{constructor(t){super(),this.config=t.prototype.config_?t.prototype.config_:t.config_,this.component=t,this.name=super.name(t),this.$inject={name:this.name,type:"component"},this.#a()}#a(){if(!this.config||!this.config())return this.component.prototype.config_=super.configInject.bind(this),void(this.config=this.component.prototype.config_);this.component.prototype.config_=super.configInject(this.config()).bind(this),this.config=this.component.prototype.config_}get(){if(this.config)return this.config()}}class h extends n{constructor(t){super(),this.config=t.prototype.config_?t.prototype.config_:t.config_,this.constant=t,this.name=super.name(this.constant),this.$inject={name:this.name,type:"constant"},this.#a()}#a(){if(!this.config||!this.config())return this.constant.prototype.config_=super.configInject.bind(this),void(this.config=this.constant.prototype.config_);this.constant.prototype.config_=super.configInject(this.config()).bind(this),this.config=this.constant.prototype.config_}get(){return this.config()}}class g extends n{constructor(t){super(),this.global=t,this.config=this.global.prototype.config_?this.global.prototype.config_:this.global.config_,this.name=super.name(this.global),this.$inject={name:this.name,type:"global"},this.#a()}#a(){if(!this.config||!this.config())return this.global.prototype.config_=super.configInject.bind(this),void(this.config=this.global.prototype.config_);this.global.prototype.config_=super.configInject(this.config()).bind(this),this.config=this.global.prototype.config_}get(){if(this.config)return this.config()}}class a{read(t,e){if(t.match(/page|pages/i)){const t=new r(e);this.conf=t.get()}else if(t.match(/component|components/i)){const t=new c(e);this.conf=t.get()}else if(t.match(/constant|const|constants/i)){const t=new h(e);this.conf=t.get()}else if(t.match(/globals|global/i)){const t=new g(e);this.conf=t.get()}}get(){return this.conf}}class p{constructor({reservoir:t,config:e,provider:s}){this.config=e,this.page=t.get("page"),this.components=t.get("components"),this.constants=t.get("constants"),this.globals=t.get("globals"),this.all=[...this.constants,...this.globals],this.provider=s,this.page&&this.all.push(["page",this.page]),this.components&&this.all.push(...this.components),this.errors={dirError:(t,e)=>`Archetype Error: ${e} is lacking location slashes, expected formatting: ${t.type}/${e}.`,pageUseError:(t,e)=>`Archetype Error: cannot use component "${e.name}" in page "${t.name}", component is already in use.`},this.#l()}#l(){this.all.forEach((t=>{const e=t[1],s=e.prototype.config_().type;this.config.read(s,e);const i=this.config.get();this.currentConfig=i,this.currentInstance=e,i.use?this.#u():(this.currentConfig=null,this.currentInstance=null)}))}#u(){this.currentConfig.use.forEach((t=>{if(!t.match(/\//g))throw this.errors.dirError(this.currentConfig,t);const e=this.provider.getDir(t);if(e){const{config:t,instance:s}=e,{name:i,type:o}=t;if("page"===this.currentConfig.type&&"component"===o)throw this.errors.pageUseError(this.currentConfig,t);this.currentInstance.prototype[i]=s}}))}}class f{constructor({reservoir:t,config:e,provider:s}){this.config=e,this.page=t.get("page"),this.components=t.get("components"),this.constants=t.get("constants"),this.globals=t.get("globals"),this.all=[...this.constants,...this.globals],this.provider=s,this.page&&this.all.concat(["page",this.page]),this.components&&this.all.concat(...this.components),this.errors={dirError:(t,e)=>`Archetype Error: ${e} is lacking location slashes, expected formatting: ${t.type}/${e}.`,pageUseError:(t,e)=>`Archetype Error: cannot use component "${e.name}" in page "${t.name}", component is already in use.`},this.#l()}#l(){this.all.forEach((t=>{const e=t[1],s=e.prototype.config_().type;this.config.read(s,e);const i=this.config.get();this.currentConfig=i,this.currentInstance=e,i.require?this.#m():(this.currentConfig=null,this.currentInstance=null)}))}#m(){this.currentConfig.require.forEach((t=>{if(!t.match(/\//g))throw this.errors.dirError(this.currentConfig,t);const{config:e,instance:s}=this.provider.getDir(t),{type:i,name:o}=e;if("page"===this.currentConfig.type&&"component"===i)throw this.errors.pageUseError(this.currentConfig,e);this.currentInstance.prototype[e.name]=s.prototype}))}}class l{constructor({reservoir:t,config:e,provider:s}){this.config=e,this.page=t.get("page"),this.components=t.get("components"),this.constants=t.get("constants"),this.globals=t.get("globals"),this.all=[...this.constants,...this.globals],this.provider=s,this.page&&this.all.concat(["page",this.page]),this.components&&this.all.concat(...this.components),this.errors={dirError:(t,e)=>`Archetype Error: ${e} is lacking location slashes, expected formatting: ${t.type}/${e}.`,pageUseError:(t,e)=>`Archetype Error: cannot use component "${e.name}" in page "${t.name}", component is already in use.`},this.#l()}#l(){this.all.forEach((t=>{const e=t[1],s=e.prototype.config_().type;this.config.read(s,e);const i=this.config.get();this.currentConfig=i,this.currentInstance=e,i.merge?this.#d():(this.currentConfig=null,this.currentInstance=null)}))}#d(){this.currentConfig.merge.forEach((t=>{if("string"==typeof t){if(!t.match(/\//g))throw this.errors.dirError(this.currentConfig,t);this.#y(t)}else this.#v(t)}))}#y(t){const{config:e,instance:s}=this.provider.getDir(t),{name:i,type:o}=e,n=Object.getOwnPropertyNames(s.prototype).filter((t=>!t.match(/constructor|config_/)));this.#b(s,n)}#v(t){const e=Object.keys(t)[0],s=this.provider.getDir(e);if(!s)return;const{config:i,instance:o}=s,{name:n,type:r}=i,c=t[e].ignore?t[e].ignore.join("|"):null,h=void 0===t[e].overwrite||t[e].overwrite;if(!e.match(/\//g))throw this.errors.dirError(this.currentConfig,e);if(t[e].methods)return void this.#b(o,t[e].methods,h);const g=Object.getOwnPropertyNames(o.prototype),a=new RegExp(`${this.provider.regEsc(c)}|constructor|config_`,"ig"),p=g.filter((t=>!t.match(a)));this.#b(o,p,h)}#b(t,e,s){e.forEach((e=>{s||this.currentInstance.prototype[e],this.currentInstance.prototype[e]=t.prototype[e]}))}}class u{constructor({reservoir:t,config:e}){this.reservoir=t,this.config=e,this.#u(),this.#m(),this.#d(),this.#w()}#u(){new p({reservoir:this.reservoir,config:this.config,provider:this})}#m(){new f({reservoir:this.reservoir,config:this.config,provider:this})}#d(){new l({reservoir:this.reservoir,config:this.config,provider:this})}#E(t,e){e.filter((t=>t.match(/^\$\w+/g))).forEach((e=>{t[e]()}))}#w(){const t=this.reservoir.get("page"),e=this.reservoir.get("constants");this.reservoir.get("components"),this.reservoir.get("globals");if(e.forEach((t=>{const e=Object.getOwnPropertyNames(t.prototype),s=new t;this.#E(s,e)})),!t)return;const s=Object.getOwnPropertyNames(t.prototype),i=new t;this.#E(i,s)}getDir(t){let e;return t.split("/").forEach((t=>{e=e?e.get(t):this.reservoir.get(t)})),e?{instance:e,config:e.prototype.config_()}:null}regEsc(t){if(t)return t=(t=(t=(t=t.replace(/\$/g,"\\$")).replace(/\./g,"\\.")).replace(/\^/g,"\\^")).replace(/\//g,"/")}}window.Archetype=class{constructor(){this.config=new a,this.reservoir=new Map,this.page=this.#t(),this.globals=this.#g(),this.constant=this.#_(),this.#w()}#t(){if(this.pages)return new e({pages:this.pages,reservoir:this.reservoir,config:this.config,componentService:s})}#g(){return new o({globals:this.globals,reservoir:this.reservoir,config:this.config})}#_(){return new i({constants:this.constant,reservoir:this.reservoir,config:this.config})}#w(){new u({reservoir:this.reservoir,config:this.config})}}})();