(()=>{"use strict";class t{constructor(){this.errors={page:{noconfig:t=>{if(!t)throw Error('A noconfig error must include a name param of the scope the error occurs in, eg: errors.get("page", "noconfig", scope.prototype.constructor.name)');return`The page scope "${t}" does not have a config_ method. A config_ method is used to return the page's route as a property.`},noroute:t=>{if(!t)throw Error('A noconfig error must include a name param of the scope the error occurs in, eg: errors.get("page", "noroute", scope.prototype.constructor.name)');return`The page "${t}" config_ method does not have a route param. A route param is required for page classes.`}}}}get(t,e,...o){if(!this.errors[t])throw Error(`${t} does not exist, error types include the following: ${Object.keys(this.errors)}`);if(!this.errors[t][e])throw Error(`${t} does not include ${e}, ${t} includes the following: ${Object.keys(this.errors[t][e])}`);return this.errors[t][e](...o)}}class e{constructor(t){this.page=t}root(t){if(!t)return;if(!this.page._render)return;document.querySelector(t()).innerHTML=this.page._render()}}class o{constructor(...t){this.components=t,this.setComponents={},this.#t(),this.#e()}#t(){this.components.forEach((t=>{const e=t.prototype.config_;if(e&&e().name){const o=e().shareWith,r=Object.getOwnPropertyNames(t.prototype).filter((t=>!t.match(/constructor|config_/)));this.setComponents[e().name]={},r.forEach((r=>{this.setComponents[e().name][r]=t.prototype[r],o&&(this.setComponents[e().name].shareWith=o)}))}}))}#e(){Object.keys(this.setComponents).forEach((t=>{this.setComponents[t].shareWith&&(this.setComponents[t].shareWith.forEach((e=>{Object.keys(this.setComponents[t]).filter((t=>!t.match(/shareWith/))).forEach((o=>{this.setComponents[e][t]=this.setComponents[t]}))})),delete this.setComponents[t].shareWith)}))}get(){return this.setComponents}}class r{static _executeIIFE(t){let e=t instanceof Function?Object.getOwnPropertyNames(t.prototype):Object.getOwnPropertyNames(t);e=e.filter((t=>t.match(/\$[^_|$]\w+/g))),e.forEach((e=>{t instanceof Function?t.prototype[e]():t[e]()}))}}class s extends r{constructor({pages:t,globals:e,root:o}){super(),this.globals=e,this.root=o,this.import={},this.page=null,this.pages=t,this._pages(),this.page&&(this._imports(),s._execute(this.page,this.root))}_pages(){const t=this.pages(s._watchPage).filter(Boolean)[0];t&&(this.page=t)}static _watchPage(t,...e){if(!s.prototype._matchRoute(t))return!1;const r=new o(...e),n=r.get();return Object.keys(r.get()).forEach((e=>{t.prototype[e]=n[e]})),s.prototype.components=n,t}_matchRoute(e){const o=new t,r=e.prototype.constructor.name;if(!e.prototype.config_)throw Error(o.get("page","noconfig",r));if(!e.prototype.config_().route)throw Error(o.get("page","noroute",r));const n=window.location.pathname,{routes:i,params:c}=s._routeInfo(e,n);return-1!==i.indexOf(n)&&(e.prototype.route_=()=>c,!0)}static _routeInfo(t,e){const o=t.prototype.config_().route,r=e.split(/\//g).filter(Boolean),s=e.split(""),n=s[s.length-1],i=[],c={},p=n.match(/\//)?"/":"";return o.forEach((t=>{const e=t.split(/\//g).filter(Boolean);let o=[];e.forEach(((t,e)=>{if(t.match(/{\w+}/))return o.push(r[e]),void(c[t.replace(/({|})/g,"")]=r[e-1]);o.push(t)}));const s=o.join("/");!s||s.match(/.*\.[a-zA-Z]/)?i.push("/"+s):s&&!s.match(/.*\.[a-zA-Z]/)&&i.push("/"+s+p)})),{routes:i,params:c}}_imports(){const t=this.page.prototype.config_().import;this.page.prototype.config_().import&&t.forEach((t=>{this.globals[t]&&(this.page.prototype[t]=this.globals[t])}))}static _execute(t,o){Object.getOwnPropertyNames(t.prototype).filter((t=>t.match(/\$[^_|$]\w+/g)));const r=Object.keys(s.prototype.components),n=new t;r.length&&r.forEach((t=>{const e=s.prototype.components;Object.getOwnPropertyNames(e[t]).filter((t=>t.match(/\$[^_|$]\w+/g)));s._executeIIFE(e[t])})),s._executeIIFE(t);new e(n).root(o)}}class n{constructor(t){this.globals={},this.global=t,this._global()}_global(){if(!this.global)return;this.global().forEach((t=>{const e=t.prototype.config_,o=e?e().name:t.prototype.constructor.name,r=Object.getOwnPropertyNames(t.prototype).filter((t=>!t.match(/config_|constructor/i)));this.globals[o]={},r.forEach((e=>{this.globals[o][e]=t.prototype[e]}))}))}get(){return this.globals}}class i extends r{constructor(t){super(),this.persist=t,this.imports={},this.test={},this.persist&&this._persist()}_persist(){const t=this.persist(i._provide).filter(Boolean);t.length&&t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).filter((t=>t.match(/\$[^_|$]\w+/g))),new t;i._executeIIFE(t)}))}static _provide(t,...e){e.forEach((e=>{const o=Object.getOwnPropertyNames(e.prototype).filter((t=>!t.match(/constructor/i))),r=e.prototype.config_?e.prototype.config_().name:e.prototype.constructor.name;t.prototype[r]={},o.forEach((o=>{t.prototype[r][o]=e.prototype[o]}))}));new t;i._executeIIFE(t)}}window.Archetype=class{constructor(){this.core={},this.persist=new i(this.persist),this.globals=new n(this.gobal),this.pages=new s({pages:this.pages,globals:this.globals.get(),root:this.root})}}})();